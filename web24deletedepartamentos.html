<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>delete de departamentos</title>
</head>
<body>
    <h1>Delete departamentos</h1>
    <ul id="listadepartamentos"></ul>

    <script src="js/jquery-3.7.1.js"></script>
    <script>
        //Cargamos el nombre de cada departamento en un ul
        //Dibujamos el nombre y un boton para eliminar cada departamento
        //al pulsar el boton sociado a cada departamento, eliminamos el departamento y cargamos
        url = "https://apicruddepartamentospgs.azurewebsites.net/";
        $(document).ready(function(){
            loadDepartamentos();
        })
        function loadDepartamentos(){
            let request = "webresources/departamentos"
            $.getJSON(url + request, function(data) {
                console.log("leyendo...")
                $("#listadepartamentos").html("");
                $.each(data, function(index, departamento){
                    var li = $("<li>").text(departamento.nombre + " ");
                    var boton = $("<button>", {text: "Eliminar dept " + departamento.numero, value: departamento.numero});
                    li.append(boton);
                    $("#listadepartamentos").append(li);
                    
                    boton.click(function(){
                        var idDept = $(this).val();
                        console.log("click boton "+idDept)
                        var request = "webresources/departamentos/delete/" + idDept;
                        $.ajax({
                            url: url + request,
                            type: "DELETE",
                            success: function(){
                                console.log("Eliminado correctamente");
                                loadDepartamentos();
                            }
                        })
                    })
                })
            })
        }
    </script>
</body>
</html>